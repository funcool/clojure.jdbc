<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="Andrey Antukh, &lt;niwi@niwi.be&gt;">
<title>clojure.jdbc documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<style>
.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f0f0f0; }
.listingblock .pygments .tok-c { color: #60a0b0; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #007020; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #60a0b0; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #007020 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #60a0b0; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #60a0b0; background-color: #fff0f0 } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #007020; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #007020 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #902000 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #40a070 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #4070a0 } /* Literal.String */
.listingblock .pygments .tok-na { color: #4070a0 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #007020 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0e84b5; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #60add5 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #555555; font-weight: bold } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #d55537; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #007020 } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #06287e } /* Name.Function */
.listingblock .pygments .tok-nl { color: #002070; font-weight: bold } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #062873; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #bb60d5 } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #007020; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #40a070 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #40a070 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #40a070 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #40a070 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #40a070 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #4070a0 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #4070a0 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #4070a0; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #4070a0 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #4070a0; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #4070a0 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #70a0d0; font-style: italic } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #c65d09 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #235388 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #4070a0 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #517918 } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #007020 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #bb60d5 } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #bb60d5 } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #bb60d5 } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #40a070 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>clojure.jdbc documentation</h1>
<div class="details">
<span id="author" class="author">Andrey Antukh, &lt;niwi@niwi.be&gt;</span><br>
<span id="revdate">0.4.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_philosophy">1.1. Philosophy</a></li>
</ul>
</li>
<li><a href="#_project_maturity">2. Project Maturity</a></li>
<li><a href="#_install">3. Install</a>
<ul class="sectlevel2">
<li><a href="#_requirements">3.1. Requirements</a></li>
<li><a href="#_leiningen">3.2. Leiningen</a></li>
<li><a href="#_gradle">3.3. Gradle</a></li>
<li><a href="#_get_the_code">3.4. Get the Code</a></li>
</ul>
</li>
<li><a href="#_user_guide">4. User Guide</a>
<ul class="sectlevel2">
<li><a href="#_connecting_to_database">4.1. Connecting to database</a></li>
<li><a href="#_execute_database_commands">4.2. Execute Database Commands</a></li>
<li><a href="#_make_queries">4.3. Make Queries</a></li>
<li><a href="#_transactions">4.4. Transactions</a></li>
</ul>
</li>
<li><a href="#_advanced_usage">5. Advanced usage</a>
<ul class="sectlevel2">
<li><a href="#cursor-queries">5.1. Server Side Cursors</a></li>
<li><a href="#transaction-strategy">5.2. Transaction Strategy</a></li>
<li><a href="#_extend_sql_types">5.3. Extend SQL Types</a></li>
</ul>
</li>
<li><a href="#connection-pool">6. Connection pool</a>
<ul class="sectlevel2">
<li><a href="#_c3p0">6.1. c3p0</a></li>
<li><a href="#_dbcp2">6.2. dbcp2</a></li>
<li><a href="#_hikaricp">6.3. HikariCP</a></li>
</ul>
</li>
<li><a href="#_how_to_contribute">7. How to Contribute?</a></li>
<li><a href="#_faq">8. FAQ</a>
<ul class="sectlevel2">
<li><a href="#_why_another_jdbc_wrapper">8.1. Why another JDBC wrapper?</a></li>
<li><a href="#_does_clojure_jdbc_have_better_performance_than_java_jdbc">8.2. Does clojure.jdbc have better performance than java.jdbc?</a></li>
<li><a href="#_why_does_clojure_jdbc_not_include_a_dsl_for_working_with_sql_as_java_jdbc_0_3_does">8.3. Why does clojure.jdbc not include a DSL for working with SQL as java.jdbc 0.3 does?</a></li>
<li><a href="#_is_this_a_fork_of_java_jdbc">8.4. Is this a fork of java.jdbc?</a></li>
</ul>
</li>
<li><a href="#_license">9. License</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>clojure.jdbc</em> is a library for low level, jdbc-based database access.</p>
</div>
<div class="paragraph">
<p><a href="api/index.html">Api reference documentation.</a></p>
</div>
<div class="sect2">
<h3 id="_philosophy">1.1. Philosophy</h3>
<div class="paragraph">
<p>Five most important rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Beautiful is better than ugly.</p>
</li>
<li>
<p>Explicit is better than implicit.</p>
</li>
<li>
<p>Simple is better than complex.</p>
</li>
<li>
<p>Complex is better than complicated.</p>
</li>
<li>
<p>Readability counts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All contributions to <em>clojure.jdbc</em> should keep these important rules in mind.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_project_maturity">2. Project Maturity</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since <em>clojure.jdbc</em> is a young project there may be some API breakage.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install">3. Install</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section covers a installing <em>clojure.jdbc</em> and its requirements.</p>
</div>
<div class="sect2">
<h3 id="_requirements">3.1. Requirements</h3>
<div class="paragraph">
<p><em>clojure.jdbc</em> is tested with these platforms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JDK7</p>
</li>
<li>
<p>JDK8</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_leiningen">3.2. Leiningen</h3>
<div class="paragraph">
<p>The simplest way to use <em>clojure.jdbc</em> in a clojure project, is by including it in the dependency
vector on your <strong><em>project.clj</em></strong> file:</p>
</div>
<div class="listingblock">
<div class="title"><em>on project.clj</em></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">[</span><span class="tok-nv">clojure.jdbc</span> <span class="tok-s">&quot;0.4.0&quot;</span><span class="tok-p">]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_gradle">3.3. Gradle</h3>
<div class="paragraph">
<p>If you are using gradle, this is a dependency line for gradle dsl:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">compile</span> <span class="tok-s2">&quot;clojure.jdbc:clojure.jdbc:0.4.0&quot;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_get_the_code">3.4. Get the Code</h3>
<div class="paragraph">
<p><em>clojure.jdbc</em> is open source and you can found the source on <a href="https://github.com/niwibe/clojure.jdbc">github</a>.</p>
</div>
<div class="paragraph">
<p>You can clone the public repository with this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">git clone https://github.com/niwibe/clojure.jdbc</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_guide">4. User Guide</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_connecting_to_database">4.1. Connecting to database</h3>
<div class="sect3">
<h4 id="_connection_parameters">4.1.1. Connection parameters</h4>
<div class="paragraph">
<p>JDBC is the default Java abstraction/interface for SQL databases.  It&#8217;s like
the Python DB-API and similar abstractions in other languages.  Clojure, as a
guest language on the JVM, benefits from having a good, well-tested abstraction
like that.</p>
</div>
<div class="paragraph">
<p>Connection parameters are exposed in a simple hash-map and called <strong>dbspec</strong>. This is the simplest
and most idiomatic way in Clojure to define configuration parameters.</p>
</div>
<div class="listingblock">
<div class="title">This is a default aspect of one dbspec.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-k">def </span><span class="tok-nv">dbspec</span> <span class="tok-p">{</span><span class="tok-ss">:subprotocol</span> <span class="tok-s">&quot;postgresql&quot;</span>
             <span class="tok-ss">:subname</span> <span class="tok-s">&quot;//localhost:5432/dbname&quot;</span>
             <span class="tok-ss">:user</span> <span class="tok-s">&quot;username&quot;</span>         <span class="tok-c1">;; Optional</span>
             <span class="tok-ss">:password</span> <span class="tok-s">&quot;password&quot;</span><span class="tok-p">}</span>    <span class="tok-c1">;; Optional</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, <em>clojure.jdbc</em> comes with alternative, more human comprehensible format, like this:</p>
</div>
<div class="listingblock">
<div class="title">Pretty dbspec format</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-k">def </span><span class="tok-nv">dbspec</span> <span class="tok-p">{</span><span class="tok-ss">:vendor</span> <span class="tok-s">&quot;postgresql&quot;</span>
             <span class="tok-ss">:name</span> <span class="tok-s">&quot;dbname&quot;</span>
             <span class="tok-ss">:host</span> <span class="tok-s">&quot;localhost&quot;</span>      <span class="tok-c1">;; Optional</span>
             <span class="tok-ss">:port</span> <span class="tok-mi">5432</span>             <span class="tok-c1">;; Optional</span>
             <span class="tok-ss">:user</span> <span class="tok-s">&quot;username&quot;</span>       <span class="tok-c1">;; Optional</span>
             <span class="tok-ss">:password</span> <span class="tok-s">&quot;password&quot;</span><span class="tok-p">})</span> <span class="tok-c1">;; Optional</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But it has some disadvantages: it does not supports all options of a default dbspec format.</p>
</div>
<div class="paragraph">
<p>Also, <strong>dbspec</strong> can be represented as a URI.</p>
</div>
<div class="listingblock">
<div class="title">Same as the previous example but using URI format.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-k">def </span><span class="tok-nv">dbspec</span> <span class="tok-s">&quot;postgresql://user:password@localhost:5432/dbname&quot;</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_connection">4.1.2. Creating a connection</h4>
<div class="paragraph">
<p>With clojure.jdbc every function that interacts with a database explicitly requires
one connection instance as parameter (no dynamic vars are used for it).</p>
</div>
<div class="listingblock">
<div class="title">Create one connection using <code>connection</code> function:</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nf">require</span> <span class="tok-o">&#39;</span><span class="tok-p">[</span><span class="tok-nv">jdbc.core</span> <span class="tok-ss">:as</span> <span class="tok-nv">jdbc</span><span class="tok-p">])</span>

<span class="tok-p">(</span><span class="tok-k">let </span><span class="tok-p">[</span><span class="tok-nv">conn</span> <span class="tok-p">(</span><span class="tok-nf">jdbc/connection</span> <span class="tok-nv">dbspec</span><span class="tok-p">)]</span>
  <span class="tok-p">(</span><span class="tok-nf">do-something-with</span> <span class="tok-nv">conn</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nf">.close</span> <span class="tok-nv">conn</span><span class="tok-p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see in previous example, you should explicltly close connection for proper
resource management. You can use the <code>with-open</code> clojure macro for make code looks
more clean and idiomatic.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nb">with-open </span><span class="tok-p">[</span><span class="tok-nv">conn</span> <span class="tok-p">(</span><span class="tok-nf">jdbc/connection</span> <span class="tok-nv">dbspec</span><span class="tok-p">)]</span>
  <span class="tok-p">(</span><span class="tok-nf">do-something-with</span> <span class="tok-nv">conn</span><span class="tok-p">))</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_execute_database_commands">4.2. Execute Database Commands</h3>
<div class="sect3">
<h4 id="_execute_raw_sql_statements">4.2.1. Execute Raw SQL Statements</h4>
<div class="paragraph">
<p>The simplest way to execute raw SQL is using the <code>execute!</code> function. It requires
an active connection as the first parameter followed by SQL sentences:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nb">with-open </span><span class="tok-p">[</span><span class="tok-nv">conn</span> <span class="tok-p">(</span><span class="tok-nf">jdbc/connection</span> <span class="tok-nv">dbspec</span><span class="tok-p">)]</span>
  <span class="tok-p">(</span><span class="tok-nf">jdbc/execute!</span> <span class="tok-nv">conn</span> <span class="tok-s">&quot;CREATE TABLE foo (id serial, name text);&quot;</span><span class="tok-p">))</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_execute_parametrized_sql_statements">4.2.2. Execute Parametrized SQL Statements</h4>
<div class="paragraph">
<p>Raw SQL statements work well for creating tables and similar operations, but
when you need to insert some data, especially if the data comes from untrusted
sources, the <code>execute!</code> function is not a good option.</p>
</div>
<div class="paragraph">
<p>For this problem, clojure.jdbc exposes the <code>execute-prepared!</code> function. It
accepts parametrized SQL and a list of groups of parameters that allow
the repeated execution of the same operations with distinct parameters.</p>
</div>
<div class="listingblock">
<div class="title">Execute a simple insert SQL statement.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-k">let </span><span class="tok-p">[</span><span class="tok-nv">sql</span> <span class="tok-s">&quot;INSERT INTO foo (name) VALUES (?)&quot;</span><span class="tok-p">]</span>
  <span class="tok-p">(</span><span class="tok-nf">jdbc/execute-prepared!</span> <span class="tok-nv">conn</span> <span class="tok-p">[</span><span class="tok-nv">sql</span> <span class="tok-s">&quot;Foo&quot;</span><span class="tok-p">]))</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Bulk insert example.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-k">let </span><span class="tok-p">[</span><span class="tok-nv">sql</span> <span class="tok-s">&quot;INSERT INTO foo (name) VALUES (?)&quot;</span><span class="tok-p">]</span>
  <span class="tok-p">(</span><span class="tok-nf">jdbc/execute-prepared!</span> <span class="tok-nv">conn</span> <span class="tok-nv">sql</span> <span class="tok-p">[</span><span class="tok-s">&quot;Foo&quot;</span><span class="tok-p">]</span> <span class="tok-p">[</span><span class="tok-s">&quot;Bar&quot;</span><span class="tok-p">]))</span>

<span class="tok-c1">;; This should emit this sql:</span>
<span class="tok-c1">;;   INSERT INTO foo (name) VALUES (&#39;Foo&#39;);</span>
<span class="tok-c1">;;   INSERT INTO foo (name) VALUES (&#39;Bar&#39;);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_returning_inserted_keys">4.2.3. Returning Inserted Keys</h4>
<div class="paragraph">
<p>In some circumstances, you want use "RETURNING id" or similar functionality on
your queries for return the primary keys of newly inserted records.</p>
</div>
<div class="paragraph">
<p>This is how you can do it using clojure.jdbc:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-k">let </span><span class="tok-p">[</span><span class="tok-nv">sql</span> <span class="tok-s">&quot;INSERT INTO foo (name) VALUES (?);&quot;</span>
      <span class="tok-nv">res</span> <span class="tok-p">(</span><span class="tok-nf">jdbc/execute-prepared!</span> <span class="tok-nv">conn</span> <span class="tok-nv">sql</span> <span class="tok-p">[</span><span class="tok-s">&quot;Foo&quot;</span><span class="tok-p">]</span> <span class="tok-p">[</span><span class="tok-s">&quot;Bar&quot;</span><span class="tok-p">]</span> <span class="tok-p">{</span><span class="tok-ss">:returning</span> <span class="tok-p">[</span><span class="tok-ss">:id</span><span class="tok-p">]})]</span>
  <span class="tok-p">(</span><span class="tok-nb">println </span><span class="tok-nv">res</span><span class="tok-p">))</span>

<span class="tok-c1">;; This should print something like this to standard output:</span>
<span class="tok-p">[{</span><span class="tok-ss">:id</span> <span class="tok-mi">3</span><span class="tok-p">}</span> <span class="tok-p">{</span><span class="tok-ss">:id</span> <span class="tok-mi">4</span><span class="tok-p">}]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, you can use <code>:all</code> keyword in case of you need statement with "RETURNING *".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nf">jdbc/execute-prepared!</span> <span class="tok-nv">conn</span> <span class="tok-nv">sql</span> <span class="tok-p">[</span><span class="tok-s">&quot;foo&quot;</span><span class="tok-p">]</span> <span class="tok-p">{</span><span class="tok-ss">:returning</span> <span class="tok-ss">:all</span><span class="tok-p">})</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_make_queries">4.3. Make Queries</h3>
<div class="paragraph">
<p>The basic way to query a database is using the <code>query</code> function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-k">let </span><span class="tok-p">[</span><span class="tok-nv">sql</span>    <span class="tok-p">[</span><span class="tok-s">&quot;SELECT id, name FROM people WHERE age &gt; ?&quot;</span>, <span class="tok-mi">2</span><span class="tok-p">]</span>
      <span class="tok-nv">result</span> <span class="tok-p">(</span><span class="tok-nf">jdbc/query</span> <span class="tok-nv">conn</span> <span class="tok-nv">sql</span><span class="tok-p">)]</span>
  <span class="tok-p">(</span><span class="tok-nb">doseq </span><span class="tok-p">[</span><span class="tok-nv">row</span> <span class="tok-nv">results</span><span class="tok-p">]</span>
    <span class="tok-p">(</span><span class="tok-nb">println </span><span class="tok-nv">row</span><span class="tok-p">))))</span>

<span class="tok-c1">;; It should print this:</span>
<span class="tok-c1">;; =&gt; {:id 1 :name &quot;Foo&quot;}</span>
<span class="tok-c1">;; =&gt; {:id 2 :name &quot;Bar&quot;}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Parametrized sql can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A vector with first element a sql string following with parameters</p>
</li>
<li>
<p>A native string (SQL query without parameters)</p>
</li>
<li>
<p>An instance of <code>PreparedStatement</code></p>
</li>
<li>
<p>An instance of any type that implements the <code>ISQLStatement</code> protocol.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This method seems useful in most cases but may not work well with
queries that returns a lot of results. For this purpose, cursor type queries exist
that are explained in the <a href="#cursor-queries">Advanced usage</a> section.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_transactions">4.4. Transactions</h3>
<div class="sect3">
<h4 id="_getting_started_with_transactions">4.4.1. Getting Started with Transactions</h4>
<div class="paragraph">
<p>All transaction related functions in <em>clojure.jdbc</em> are exposed under the <code>jdbc.transaction</code>
namespace and if you need transactions in your code, you should import it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nf">require</span> <span class="tok-o">&#39;</span><span class="tok-p">[</span><span class="tok-nv">jdbc.transaction</span> <span class="tok-ss">:as</span> <span class="tok-nv">tx</span><span class="tok-p">])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The most idiomatic way to wrap some code in a transaction, is by using the <code>with-transaction</code>
macro:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nf">tx/with-transaction</span> <span class="tok-nv">conn</span>
  <span class="tok-p">(</span><span class="tok-nf">do-thing-first</span> <span class="tok-nv">conn</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nf">do-thing-second</span> <span class="tok-nv">conn</span><span class="tok-p">))</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><em>clojure.jdbc</em> does not uses any dynamic thread-local vars to store the transaction state
of a connection. Instead of that, it overwrites the lexical scope value of <code>conn</code> with a new
connection that has transactional state.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_low_level_transaction_primitives">4.4.2. Low-level Transaction Primitives</h4>
<div class="paragraph">
<p>Behind the scenes of the <code>with-transaction</code> macro, <em>clojure.jdbc</em> uses the <code>call-in-transaction</code>
function.</p>
</div>
<div class="paragraph">
<p>Given an active connection as the first parameter and function that you want execute in a
transaction as the second parameter, it executes the function inside a database transaction.
The function should accept a connection as its first parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nf">tx/call-in-transaction</span> <span class="tok-nv">conn</span> <span class="tok-p">(</span><span class="tok-k">fn </span><span class="tok-p">[</span><span class="tok-nv">conn</span><span class="tok-p">]</span> <span class="tok-p">(</span><span class="tok-nf">do-something-with</span> <span class="tok-nv">conn</span><span class="tok-p">)))</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>clojure.jdbc, in contrast to java.jdbc, handles nested transactions well. Thus making all
code wrapped in transaction blocks truly atomic independently of transaction nesting.</p>
</div>
<div class="paragraph">
<p>If you want extend or change a default transaction strategy, see
<a href="#transaction-strategy">Transaction Strategy section</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_isolation_level">4.4.3. Isolation Level</h4>
<div class="paragraph">
<p>clojure.jdbc by default does nothing with the isolation level and keeps it to default values.</p>
</div>
<div class="listingblock">
<div class="title">You can set the isolation level when creating a connection by specifying it in your dbspec.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-k">def </span><span class="tok-nv">dbspec</span> <span class="tok-p">{</span><span class="tok-ss">:subprotocol</span> <span class="tok-s">&quot;h2&quot;</span>
             <span class="tok-ss">:subname</span> <span class="tok-s">&quot;mem:&quot;</span>
             <span class="tok-ss">:isolation-level</span> <span class="tok-ss">:serializable</span><span class="tok-p">})</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Or set it when executing a transaction</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nf">tx/call-in-transaction</span> <span class="tok-nv">conn</span> <span class="tok-nv">do-something</span> <span class="tok-p">{</span><span class="tok-ss">:isolation-level</span> <span class="tok-ss">:serializable</span><span class="tok-p">})</span>

<span class="tok-c1">;; Or...</span>

<span class="tok-p">(</span><span class="tok-nf">tx/with-transaction</span> <span class="tok-nv">conn</span> <span class="tok-p">{</span><span class="tok-ss">:isolation-level</span> <span class="tok-ss">:serializable</span><span class="tok-p">}</span>
  <span class="tok-p">(</span><span class="tok-nf">do-something</span> <span class="tok-nv">conn</span><span class="tok-p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a list of supported options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>:read-uncommited</code> - Set read uncommited isolation level</p>
</li>
<li>
<p><code>:read-commited</code> - Set read committed isolation level</p>
</li>
<li>
<p><code>:repeatable-read</code> - Set repeatable reads isolation level</p>
</li>
<li>
<p><code>:serializable</code> - Set serializable isolation level</p>
</li>
<li>
<p><code>:none</code> - Use this option to indicate to clojure.jdbc to do nothing and keep default behavior.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can read more about it on <a href="http://en.wikipedia.org/wiki/Isolation_(database_systems)">wikipedia</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
not all JDBC providers support the above isolation levels.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_read_only_transactions">4.4.4. Read-Only Transactions</h4>
<div class="paragraph">
<p>In some circumstances, mainly when you are using the strictest isolation-level, you may want
to indicate to database that a query is actually read-only, allowing the database server to make some
optimizations for this operation.</p>
</div>
<div class="listingblock">
<div class="title">You can set transaction read-only using transaction options</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nf">tx/with-transaction</span> <span class="tok-nv">conn</span> <span class="tok-p">{</span><span class="tok-ss">:isolation-level</span> <span class="tok-ss">:serializable</span>
                           <span class="tok-ss">:read-only</span> <span class="tok-nv">true</span><span class="tok-p">}</span>
  <span class="tok-p">(</span><span class="tok-nf">query-something</span> <span class="tok-nv">conn</span><span class="tok-p">))</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_usage">5. Advanced usage</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="cursor-queries">5.1. Server Side Cursors</h3>
<div class="paragraph">
<p>By default, most JDBC drivers prefetch all results into memory make the use of lazy structures
totally useless for fetching data. Luckily, some databases implement server-side cursors that avoid
this behavior.</p>
</div>
<div class="paragraph">
<p>If you have an extremely large resultset and you want retrieve it and process each item, this is
exactly what you need.</p>
</div>
<div class="paragraph">
<p>For this purpose, <em>clojure.jdbc</em> exposes the <code>lazy-query</code> function, that returns a some kind of
cursor instance. At the moment of creating cursor, no query is executed.</p>
</div>
<div class="paragraph">
<p>The cursor can be used converting it into clojure lazyseq using <code>cursor-&gt;lazyseq</code> function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nf">with-transaction</span> <span class="tok-nv">conn</span>
  <span class="tok-p">(</span><span class="tok-nb">with-open </span><span class="tok-p">[</span><span class="tok-nv">cursor</span> <span class="tok-p">(</span><span class="tok-nf">jdbc/lazy-query</span> <span class="tok-nv">conn</span> <span class="tok-p">[</span><span class="tok-s">&quot;SELECT id, name FROM people;&quot;</span><span class="tok-p">])]</span>
    <span class="tok-p">(</span><span class="tok-nb">doseq </span><span class="tok-p">[</span><span class="tok-nv">row</span> <span class="tok-p">(</span><span class="tok-nf">jdbc/cursor-&gt;lazyseq</span> <span class="tok-nv">cursor</span><span class="tok-p">)]</span>
      <span class="tok-p">(</span><span class="tok-nb">println </span><span class="tok-nv">row</span><span class="tok-p">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In some databases, it requires that cursor should be evaluated in a context of one
transaction.</p>
</div>
</div>
<div class="sect2">
<h3 id="transaction-strategy">5.2. Transaction Strategy</h3>
<div class="paragraph">
<p>Transaction strategies in <em>clojure.jdbc</em> are implemented using protocols having default
implementation explained in the previous sections. This approach allows an easy way to extend,
customize or completely change a transaction strategy for your application.</p>
</div>
<div class="paragraph">
<p>If you want another strategy, you should create a new type and implement the
<code>ITransactionStrategy</code> protocol.</p>
</div>
<div class="listingblock">
<div class="title">Sample dummy transaction strategy.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-k">def </span><span class="tok-nv">dummy-tx-strategy</span>
  <span class="tok-p">(</span><span class="tok-nf">reify</span> <span class="tok-nv">tx/ITransactionStrategy</span>
    <span class="tok-p">(</span><span class="tok-nf">begin!</span> <span class="tok-p">[</span><span class="tok-nv">_</span> <span class="tok-nv">conn</span> <span class="tok-nv">opts</span><span class="tok-p">]</span> <span class="tok-nv">conn</span><span class="tok-p">)</span>
    <span class="tok-p">(</span><span class="tok-nf">rollback!</span> <span class="tok-p">[</span><span class="tok-nv">_</span> <span class="tok-nv">conn</span> <span class="tok-nv">opts</span><span class="tok-p">]</span> <span class="tok-nv">conn</span><span class="tok-p">)</span>
    <span class="tok-p">(</span><span class="tok-nf">commit!</span> <span class="tok-p">[</span><span class="tok-nv">_</span> <span class="tok-nv">conn</span> <span class="tok-nv">opts</span><span class="tok-p">]</span> <span class="tok-nv">conn</span><span class="tok-p">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can specify the transaction strategy to use in these ways:</p>
</div>
<div class="listingblock">
<div class="title">Using the <code>with-transaction-strategy</code> macro.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nb">with-open </span><span class="tok-p">[</span><span class="tok-nv">conn</span> <span class="tok-p">(</span><span class="tok-nf">jdbc/connection</span> <span class="tok-nv">conn</span><span class="tok-p">)]</span>
  <span class="tok-p">(</span><span class="tok-nf">tx/with-transaction-strategy</span> <span class="tok-nv">conn</span> <span class="tok-nv">dummy-tx-strategy</span>
    <span class="tok-p">(</span><span class="tok-nf">do-some-thing</span> <span class="tok-nv">conn</span><span class="tok-p">)))</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>with-transaction-strategy</code> does not use dynamic vars, it simple associate the
strategy to connection and exposes it.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Using the <code>wrap-transaction-strategy</code> function:</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nb">with-open </span><span class="tok-p">[</span><span class="tok-nv">conn</span> <span class="tok-p">(</span><span class="tok-nb">-&gt; </span><span class="tok-p">(</span><span class="tok-nf">jdbc/connection</span> <span class="tok-nv">dbspec</span><span class="tok-p">)</span>
                     <span class="tok-p">(</span><span class="tok-nf">jdbc/wrap-transaction-strategy</span> <span class="tok-nv">dummy-tx-strategy</span><span class="tok-p">))]</span>
  <span class="tok-p">(</span><span class="tok-nf">do-some-thing</span> <span class="tok-nv">conn</span><span class="tok-p">))</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Using dynamic vars</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-c1">;; Overwritting the default value</span>
<span class="tok-p">(</span><span class="tok-nf">alter-var-root</span> <span class="tok-o">#</span><span class="tok-ss">&#39;tx/*default-tx-strategy*</span> <span class="tok-p">(</span><span class="tok-k">fn </span><span class="tok-p">[</span><span class="tok-nv">_</span><span class="tok-p">]</span> <span class="tok-nv">dummy-tx-strategy</span><span class="tok-p">))</span>

<span class="tok-c1">;; Or using binding</span>
<span class="tok-p">(</span><span class="tok-nb">binding </span><span class="tok-p">[</span><span class="tok-nv">tx/*default-tx-strategy*</span> <span class="tok-nv">dummy-tx-strategy</span><span class="tok-p">]</span>
  <span class="tok-p">(</span><span class="tok-nf">some-func-that-uses-transactions</span><span class="tok-p">))</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extend_sql_types">5.3. Extend SQL Types</h3>
<div class="paragraph">
<p>Everything related to type handling/conversion is exposed in the <code>jdbc.proto</code> namespace.</p>
</div>
<div class="paragraph">
<p>If you want to extend some type/class to use it as JDBC parameter without explicit conversion
to an SQL-compatible type, you should extend your type with the <code>jdbc.proto/ISQLType</code> protocol.</p>
</div>
<div class="paragraph">
<p>Here is an example which extends Java&#8217;s String[] (string array) in order to pass it as
a query parameter that corresponds to PostgreSQL text array in the database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nf">require</span> <span class="tok-o">&#39;</span><span class="tok-p">[</span><span class="tok-nv">jdbc.proto</span> <span class="tok-ss">:as</span> <span class="tok-nv">proto</span><span class="tok-p">])</span>

<span class="tok-p">(</span><span class="tok-nf">extend-protocol</span> <span class="tok-nv">ISQLType</span>
  <span class="tok-c1">;; Obtain a class for string array</span>
  <span class="tok-p">(</span><span class="tok-nb">class </span><span class="tok-p">(</span><span class="tok-nb">into-array </span><span class="tok-nv">String</span> <span class="tok-p">[]))</span>

  <span class="tok-p">(</span><span class="tok-nf">set-stmt-parameter!</span> <span class="tok-p">[</span><span class="tok-nv">this</span> <span class="tok-nv">conn</span> <span class="tok-nv">stmt</span> <span class="tok-nv">index</span><span class="tok-p">]</span>
    <span class="tok-p">(</span><span class="tok-k">let </span><span class="tok-p">[</span><span class="tok-nv">rconn</span> <span class="tok-p">(</span><span class="tok-nf">proto/get-connection</span> <span class="tok-nv">conn</span><span class="tok-p">)</span>
          <span class="tok-nv">value</span> <span class="tok-p">(</span><span class="tok-nf">proto/as-sql-type</span> <span class="tok-nv">this</span> <span class="tok-nv">conn</span><span class="tok-p">)</span>
          <span class="tok-nv">array</span> <span class="tok-p">(</span><span class="tok-nf">.createArrayOf</span> <span class="tok-nv">raw-conn</span> <span class="tok-s">&quot;text&quot;</span> <span class="tok-nv">value</span><span class="tok-p">)]</span>
      <span class="tok-p">(</span><span class="tok-nf">.setArray</span> <span class="tok-nv">stmt</span> <span class="tok-nb">index </span><span class="tok-nv">array</span><span class="tok-p">)))</span>

  <span class="tok-p">(</span><span class="tok-nf">as-sql-type</span> <span class="tok-p">[</span><span class="tok-nv">this</span> <span class="tok-nv">conn</span><span class="tok-p">]</span> <span class="tok-nv">this</span><span class="tok-p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this way you can pass a string array as a JDBC parameter that is automatically converted
to an SQL array and assigned properly in a prepared statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nb">with-open </span><span class="tok-p">[</span><span class="tok-nv">conn</span> <span class="tok-p">(</span><span class="tok-nf">jdbc/connection</span> <span class="tok-nv">pg-dbspec</span><span class="tok-p">)]</span>
  <span class="tok-p">(</span><span class="tok-nf">jdbc/execute!</span> <span class="tok-nv">conn</span> <span class="tok-s">&quot;CREATE TABLE arrayfoo (id integer, data text[]);&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-k">let </span><span class="tok-p">[</span><span class="tok-nv">mystringarray</span> <span class="tok-p">(</span><span class="tok-nb">into-array </span><span class="tok-nv">String</span> <span class="tok-p">[</span><span class="tok-s">&quot;foo&quot;</span> <span class="tok-s">&quot;bar&quot;</span><span class="tok-p">])]</span>
    <span class="tok-p">(</span><span class="tok-nf">jdbc/execute-prepared!</span> <span class="tok-nv">conn</span> <span class="tok-s">&quot;INSERT INTO arrayfoo VALUES (?, ?);&quot;</span>
                            <span class="tok-p">[</span><span class="tok-mi">1</span>, <span class="tok-nv">mystringarray</span><span class="tok-p">])))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>clojure.jdbc also exposes the <code>jdbc.proto/ISQLResultSetReadColumn</code> protocol that encapsulates
reverse conversions from SQL types to user-defined types.</p>
</div>
<div class="paragraph">
<p>You can read more about that in this blog post: <a href="http://www.niwi.be/2014/04/13/postgresql-json-field-with-clojure-and-jdbc/" class="bare">http://www.niwi.be/2014/04/13/postgresql-json-field-with-clojure-and-jdbc/</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="connection-pool">6. Connection pool</h2>
<div class="sectionbody">
<div class="paragraph">
<p>DataSource is the preferd way to connect to the database in production enviroments, and
is usually used for implement connection pools.</p>
</div>
<div class="paragraph">
<p>To make good use of resourses is much recommendable use some kind of connection pool
implementation. This can avoid continuosly creating and destroying connections,
that in the majority of time is a slow operation.</p>
</div>
<div class="paragraph">
<p>Java ecosystem comes with various of it. This is a list of most used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HikariCP: <a href="https://github.com/brettwooldridge/HikariCP" class="bare">https://github.com/brettwooldridge/HikariCP</a></p>
</li>
<li>
<p>c3p0: <a href="http://www.mchange.com/projects/c3p0/" class="bare">http://www.mchange.com/projects/c3p0/</a></p>
</li>
<li>
<p>Apache DBCP2: <a href="http://commons.apache.org/proper/commons-dbcp/" class="bare">http://commons.apache.org/proper/commons-dbcp/</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>clojure.jdbc</em> is compatible with any other connection pool implemenetation, simply
pass a <code>javax.sql.DataSource</code> instance to <code>jdbc/connection</code> function.</p>
</div>
<div class="sect2">
<h3 id="_c3p0">6.1. c3p0</h3>
<div class="paragraph">
<p>c3p0, a mature, highly concurrent JDBC connection pooling library for clojure.jdbc.</p>
</div>
<div class="listingblock">
<div class="title">Dependency entry</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">[</span><span class="tok-nv">com.mchange/c3p0</span> <span class="tok-s">&quot;0.9.5&quot;</span><span class="tok-p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to use this connection pool, previously you should create a DataSource instance. Here
an little example on how it can be done:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nb">import </span><span class="tok-ss">&#39;com.mchange.v2.c3p0.ComboPooledDataSource</span><span class="tok-p">)</span>

<span class="tok-p">(</span><span class="tok-k">def </span><span class="tok-nv">ds</span> <span class="tok-p">(</span><span class="tok-nb">doto </span><span class="tok-p">(</span><span class="tok-nf">ComboPooledDataSource.</span><span class="tok-p">)</span>
          <span class="tok-p">(</span><span class="tok-nf">.setJdbcUrl</span> <span class="tok-p">(</span><span class="tok-nb">str </span><span class="tok-s">&quot;jdbc:&quot;</span>
                            <span class="tok-p">(</span><span class="tok-ss">:subprotocol</span> <span class="tok-nv">dbspec</span><span class="tok-p">)</span>
                            <span class="tok-p">(</span><span class="tok-ss">:subname</span> <span class="tok-nv">dbspec</span><span class="tok-p">)))</span>
          <span class="tok-p">(</span><span class="tok-nf">.setUser</span> <span class="tok-p">(</span><span class="tok-ss">:user</span> <span class="tok-nv">dbspec</span> <span class="tok-nv">nil</span><span class="tok-p">))</span>
          <span class="tok-p">(</span><span class="tok-nf">.setPassword</span> <span class="tok-p">(</span><span class="tok-ss">:password</span> <span class="tok-nv">dbspec</span> <span class="tok-nv">nil</span><span class="tok-p">))</span>

          <span class="tok-c1">;; Pool Size Management</span>
          <span class="tok-p">(</span><span class="tok-nf">.setMinPoolSize</span> <span class="tok-mi">3</span><span class="tok-p">)</span>
          <span class="tok-p">(</span><span class="tok-nf">.setMaxPoolSize</span> <span class="tok-mi">15</span><span class="tok-p">)</span>

          <span class="tok-c1">;; Connection eviction</span>
          <span class="tok-p">(</span><span class="tok-nf">.setMaxConnectionAge</span>  <span class="tok-mi">3600</span><span class="tok-p">)</span> <span class="tok-c1">; 1 hour</span>
          <span class="tok-p">(</span><span class="tok-nf">.setMaxIdleTime</span> <span class="tok-mi">1800</span><span class="tok-p">)</span>       <span class="tok-c1">; 1/2 hour</span>
          <span class="tok-p">(</span><span class="tok-nf">.setMaxIdleTimeExcessConnections</span> <span class="tok-mi">120</span><span class="tok-p">)</span>

          <span class="tok-c1">;; Connection testing</span>
          <span class="tok-p">(</span><span class="tok-nf">.setTestConnectionOnCheckin</span> <span class="tok-nv">false</span><span class="tok-p">)</span>
          <span class="tok-p">(</span><span class="tok-nf">.setTestConnectionOnCheckout</span> <span class="tok-nv">false</span><span class="tok-p">)</span>
          <span class="tok-p">(</span><span class="tok-nf">.setIdleConnectionTestPeriod</span> <span class="tok-mi">600</span><span class="tok-p">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can found all configuration parameters here: <a href="http://www.mchange.com/projects/c3p0/#configuration" class="bare">http://www.mchange.com/projects/c3p0/#configuration</a></p>
</div>
<div class="paragraph">
<p>Now, the new created datasource should be used like a plain dbspec for creating connections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nb">with-open </span><span class="tok-p">[</span><span class="tok-nv">conn</span> <span class="tok-p">(</span><span class="tok-nf">jdbc/connection</span> <span class="tok-nv">ds</span><span class="tok-p">)]</span>
  <span class="tok-p">(</span><span class="tok-nf">do-stuff</span> <span class="tok-nv">conn</span><span class="tok-p">))</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dbcp2">6.2. dbcp2</h3>
<div class="paragraph">
<p>Apache commons DBCP (JDBC) connection pool implementation for clojure.jdbc</p>
</div>
<div class="listingblock">
<div class="title">Dependency entry</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">[</span><span class="tok-nv">org.apache.commons/commons-dbcp2</span> <span class="tok-s">&quot;2.0.1&quot;</span><span class="tok-p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to use this connection pool, previously you should create a DataSource instance. Here
an little example on how it can be done:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nb">import </span><span class="tok-ss">&#39;org.apache.commons.dbcp2.BasicDataSource</span><span class="tok-p">)</span>

<span class="tok-p">(</span><span class="tok-k">def </span><span class="tok-nv">ds</span> <span class="tok-p">(</span><span class="tok-nb">doto </span><span class="tok-p">(</span><span class="tok-nf">BasicDataSource.</span><span class="tok-p">)</span>
          <span class="tok-p">(</span><span class="tok-nf">.setJdbcUrl</span> <span class="tok-p">(</span><span class="tok-nb">str </span><span class="tok-s">&quot;jdbc:&quot;</span>
                            <span class="tok-p">(</span><span class="tok-ss">:subprotocol</span> <span class="tok-nv">dbspec</span><span class="tok-p">)</span>
                            <span class="tok-p">(</span><span class="tok-ss">:subname</span> <span class="tok-nv">dbspec</span><span class="tok-p">)))</span>
          <span class="tok-p">(</span><span class="tok-nf">.setUser</span> <span class="tok-p">(</span><span class="tok-ss">:user</span> <span class="tok-nv">dbspec</span> <span class="tok-nv">nil</span><span class="tok-p">))</span>
          <span class="tok-p">(</span><span class="tok-nf">.setPassword</span> <span class="tok-p">(</span><span class="tok-ss">:password</span> <span class="tok-nv">dbspec</span> <span class="tok-nv">nil</span><span class="tok-p">))</span>

          <span class="tok-c1">;; Pool Size Management</span>
          <span class="tok-p">(</span><span class="tok-nf">.setInitialSize</span> <span class="tok-mi">0</span><span class="tok-p">)</span>
          <span class="tok-p">(</span><span class="tok-nf">.setMaxIdle</span> <span class="tok-mi">3</span><span class="tok-p">)</span>
          <span class="tok-p">(</span><span class="tok-nf">.setMaxTotal</span> <span class="tok-mi">15</span><span class="tok-p">)</span>

          <span class="tok-c1">;; Connection eviction</span>
          <span class="tok-p">(</span><span class="tok-nf">.setMaxConnLifetimeMillis</span> <span class="tok-mi">3600000</span><span class="tok-p">)</span> <span class="tok-c1">; 1 hour</span>

          <span class="tok-c1">;; Connection testing</span>
          <span class="tok-p">(</span><span class="tok-nf">.setTestOnBorrow</span> <span class="tok-nv">false</span><span class="tok-p">)</span>
          <span class="tok-p">(</span><span class="tok-nf">.setTestOnReturn</span> <span class="tok-nv">false</span><span class="tok-p">)</span>
          <span class="tok-p">(</span><span class="tok-nf">.setTestWhileIdle</span> <span class="tok-nv">true</span><span class="tok-p">)</span>
          <span class="tok-p">(</span><span class="tok-nf">.setTimeBetweenEvictionRunsMillis</span> <span class="tok-mi">600000</span><span class="tok-p">)</span> <span class="tok-c1">;; 10 minutes</span>
          <span class="tok-p">(</span><span class="tok-nf">.setNumTestsPerEvictionRun</span> <span class="tok-mi">4</span><span class="tok-p">)</span>
          <span class="tok-p">(</span><span class="tok-nf">.setMinEvictableIdleTimeMillis</span> <span class="tok-mi">1800000</span><span class="tok-p">)))</span> <span class="tok-c1">;; 1/2 hours</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can found all configuration parameters here: <a href="http://commons.apache.org/proper/commons-dbcp/configuration.html" class="bare">http://commons.apache.org/proper/commons-dbcp/configuration.html</a></p>
</div>
<div class="paragraph">
<p>Now, the new created datasource should be used like a plain dbspec for creating connections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nb">with-open </span><span class="tok-p">[</span><span class="tok-nv">conn</span> <span class="tok-p">(</span><span class="tok-nf">jdbc/connection</span> <span class="tok-nv">ds</span><span class="tok-p">)]</span>
  <span class="tok-p">(</span><span class="tok-nf">do-stuff</span> <span class="tok-nv">conn</span><span class="tok-p">))</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hikaricp">6.3. HikariCP</h3>
<div class="paragraph">
<p>Fast, simple, reliable. HikariCP is a "zero-overhead" production ready JDBC connection pool.</p>
</div>
<div class="listingblock">
<div class="title">Dependency entry for Java8</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">[</span><span class="tok-nv">hikari-cp</span> <span class="tok-s">&quot;1.1.1&quot;</span><span class="tok-p">]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Dependency entry for Java7 or Java6</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">[</span><span class="tok-nv">hikari-cp</span> <span class="tok-s">&quot;1.1.1&quot;</span> <span class="tok-ss">:exclusions</span> <span class="tok-p">[</span><span class="tok-nv">com.zaxxer/HikariCP</span><span class="tok-p">]]</span>
<span class="tok-p">[</span><span class="tok-nv">com.zaxxer/HikariCP-java6</span> <span class="tok-s">&quot;2.2.5&quot;</span><span class="tok-p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to use this connection pool, previously you should create a DataSource instance. Here
an little example on how it can be done:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nf">require</span> <span class="tok-o">&#39;</span><span class="tok-p">[</span><span class="tok-nv">hikari-cp.core</span> <span class="tok-ss">:as</span> <span class="tok-nv">hikari</span><span class="tok-p">])</span>

<span class="tok-p">(</span><span class="tok-k">def </span><span class="tok-nv">ds</span> <span class="tok-p">(</span><span class="tok-nf">hikari/make-datasource</span>
         <span class="tok-p">{</span><span class="tok-ss">:connection-timeout</span> <span class="tok-mi">30000</span>
          <span class="tok-ss">:idle-timeout</span> <span class="tok-mi">600000</span>
          <span class="tok-ss">:max-lifetime</span> <span class="tok-mi">1800000</span>
          <span class="tok-ss">:minimum-idle</span> <span class="tok-mi">10</span>
          <span class="tok-ss">:maximum-pool-size</span>  <span class="tok-mi">10</span>
          <span class="tok-ss">:adapter</span> <span class="tok-s">&quot;postgresql&quot;</span>
          <span class="tok-ss">:username</span> <span class="tok-s">&quot;username&quot;</span>
          <span class="tok-ss">:password</span> <span class="tok-s">&quot;password&quot;</span>
          <span class="tok-ss">:database-name</span> <span class="tok-s">&quot;database&quot;</span>
          <span class="tok-ss">:server-name</span> <span class="tok-s">&quot;localhost&quot;</span>
          <span class="tok-ss">:port-number</span> <span class="tok-mi">5432</span><span class="tok-p">}))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>HikariCP, unlike other datasource implementations, requires to setup explicitly that adapter should
be used. This is a list of supported adapters:</p>
</div>
<table id="list-of-hikari-adapters" class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. List of adapters supported by HikariCP</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Adapter</th>
<th class="tableblock halign-left valign-top">Datasource class name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:derby</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.apache.derby.jdbc.ClientDataSource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:firebird</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.firebirdsql.pool.FBSimpleDataSource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:db2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.ibm.db2.jcc.DB2SimpleDataSource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:h2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.h2.jdbcx.JdbcDataSource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:hsqldb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.hsqldb.jdbc.JDBCDataSource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:mariadb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.mariadb.jdbc.MySQLDataSource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:mysql</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.mysql.jdbc.jdbc2.optional.MysqlDataSource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:sqlserver-jtds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>net.sourceforge.jtds.jdbcx.JtdsDataSource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:sqlserver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.microsoft.sqlserver.jdbc.SQLServerDataSource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:oracle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oracle.jdbc.pool.OracleDataSource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:pgjdbc-ng</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.impossibl.postgres.jdbc.PGDataSource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:postgresql</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.postgresql.ds.PGSimpleDataSource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:sybase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.sybase.jdbcx.SybDataSource</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can found more information and documentation about hikari-cp here: <a href="https://github.com/tomekw/hikari-cp" class="bare">https://github.com/tomekw/hikari-cp</a></p>
</div>
<div class="paragraph">
<p>Now, the new created datasource should be used like a plain dbspec for creating connections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="clojure"><span class="tok-p">(</span><span class="tok-nb">with-open </span><span class="tok-p">[</span><span class="tok-nv">conn</span> <span class="tok-p">(</span><span class="tok-nf">jdbc/connection</span> <span class="tok-nv">ds</span><span class="tok-p">)]</span>
  <span class="tok-p">(</span><span class="tok-nf">do-stuff</span> <span class="tok-nv">conn</span><span class="tok-p">))</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_contribute">7. How to Contribute?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>clojure.jdbc</strong> unlike Clojure and other Clojure contrib libs, does not have many
restrictions for contributions. Just follow the following steps depending on the
situation:</p>
</div>
<div class="paragraph">
<p><strong>Bugfix</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fork the GitHub repo.</p>
</li>
<li>
<p>Fix a bug/typo on a new branch.</p>
</li>
<li>
<p>Make a pull-request to master.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>New feature</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open new issue with the new feature proposal.</p>
</li>
<li>
<p>If it is accepted, follow the same steps as "bugfix".</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_faq">8. FAQ</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_why_another_jdbc_wrapper">8.1. Why another JDBC wrapper?</h3>
<div class="paragraph">
<p>This is an incomplete list of reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connection management in clojure.jdbc is simple and explicit. However, java.jdbc does not make
diferentiation between a connection or dbspec hash map. At first glace it seems more flexible,
but it requires huge additional complexity and boilerplate code on each function that receives
a connection. If you are curious, take a look at the <code>with-db-connection</code> implementation of
java.jdbc and compare it with <strong>clojure.jdbc</strong>: it will get you a good idea of the hidden and
unnecessary complexity found in java.jdbc.</p>
</li>
<li>
<p>clojure.jdbc comes with proper transaction management with full support for nested transactions,
and plugable transaction strategies. In contrast, java.jdbc comes with one unique strategy, that
does not support subtransactions (it flattens all nested transactions in one unique giving you
false security when you wraps you code in a transaction).</p>
</li>
<li>
<p>clojure.jdbc has native support for connection pools.</p>
</li>
<li>
<p>clojure.jdbc has first class documentation.</p>
</li>
<li>
<p>clojure.jdbc has a simpler implementation than java.jdbc without unnecesary code duplication. A
good example are the crud methods of java.jdbc: all them repeats the transaction logic implicitly.
In contrast, clojure.jdbc, if you want a transaction, you should wrap your code in a transaction
context explicitly.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_does_clojure_jdbc_have_better_performance_than_java_jdbc">8.2. Does clojure.jdbc have better performance than java.jdbc?</h3>
<div class="paragraph">
<p>Mostly <strong>Yes</strong>, <em>clojure.jdbc</em>  by default has better performance than java.jdbc. You can
run the micro benchmark code in your environment with: <code>lein with-profile bench run</code></p>
</div>
<div class="paragraph">
<p>In my environments, the results are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">[3/5.0.5]niwi@niwi:~/clojure.jdbc&gt; lein with-profile bench run
Simple query without connection overhead.
java.jdbc:
&quot;Elapsed time: 673.890131 msecs&quot;
clojure.jdbc:
&quot;Elapsed time: 450.329706 msecs&quot;
Simple query with connection overhead.
java.jdbc:
&quot;Elapsed time: 2490.233925 msecs&quot;
clojure.jdbc:
&quot;Elapsed time: 2239.524395 msecs&quot;
Simple query with transaction.
java.jdbc:
&quot;Elapsed time: 532.151667 msecs&quot;
clojure.jdbc:
&quot;Elapsed time: 602.482932 msecs&quot;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_why_does_clojure_jdbc_not_include_a_dsl_for_working_with_sql_as_java_jdbc_0_3_does">8.3. Why does clojure.jdbc not include a DSL for working with SQL as java.jdbc 0.3 does?</h3>
<div class="paragraph">
<p>clojure.jdbc is a wrapper for the Java JDBC interface. It doesn&#8217;t intend to provide helpers
to avoid SQL usage. There are already plenty of DSLs for working with SQL.
clojure.jdbc will not reinvent the wheel.</p>
</div>
<div class="paragraph">
<p>This is an incomplete list of Clojure DSLs for SQL:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/niwibe/suricatta" class="bare">https://github.com/niwibe/suricatta</a></p>
</li>
<li>
<p><a href="https://github.com/stch-library/sql" class="bare">https://github.com/stch-library/sql</a></p>
</li>
<li>
<p><a href="https://github.com/r0man/sqlingvo" class="bare">https://github.com/r0man/sqlingvo</a></p>
</li>
<li>
<p><a href="https://github.com/jkk/honeysql" class="bare">https://github.com/jkk/honeysql</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_is_this_a_fork_of_java_jdbc">8.4. Is this a fork of java.jdbc?</h3>
<div class="paragraph">
<p>No. It is an alternative implementation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_license">9. License</h2>
<div class="sectionbody">
<div class="paragraph">
<p>clojure.jdbc is writen from scratch and is licensed under Apache 2.0 license:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Copyright (c) 2013-2015 Andrey Antukh &lt;niwi@niwi.be&gt;

Licensed under the Apache License, Version 2.0 (the "License")
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</pre>
</div>
</div>
<div class="paragraph">
<p>You can see the full license in the LICENSE file located in the root of the project
repo.</p>
</div>
<div class="paragraph">
<p>Additionaly, I want to give thanks to the <code>java.jdbc</code> developers for their good
initial work. Some intial ideas for clojure.jdbc are taken from that project.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-03-04 19:45:48 CET
</div>
</div>
</body>
</html>